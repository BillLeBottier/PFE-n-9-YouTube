<!DOCTYPE html>
<html>
<head>
    <title>Sous-titreur Vid√©o</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" type="text/css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="header">
        <!-- Logo -->
        <div class="logo-container">
            <img src="{{ url_for('static', filename='logo_PFE.png') }}" alt="Logo PFE" class="logo-image">
        </div>
    
        <!-- Barre de navigation -->
        <nav class="navbar">
            <ul>
                <li><a href="#features">Fonctionnalit√©s</a></li>
                <li><a href="#downloads">T√©l√©chargements</a></li>
            </ul>
        </nav>
    
        <!-- Menu utilisateur (connexion) -->
        <div class="user-menu">
            <div class="user-icon" onclick="toggleUserMenu()">
                üë§
            </div>
            <div class="dropdown-menu" id="dropdownMenu">
                <input type="email" id="email" placeholder="Email" required>
                <input type="password" id="password" placeholder="Mot de passe" required>
                <button onclick="login()">Se connecter</button>
            </div>
        </div>
    
        <!-- Bouton Commencer -->
        <button class="start-btn" onclick="startProcess()">Commencer</button>
    </div>
    <div class="features">
        <!-- S√©lection du fichier -->
        <div class="feature-card">
            <div class="feature-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                    <polyline points="13 2 13 9 20 9"></polyline>
                </svg>
            </div>
            <h3 class="feature-title">S√©lectionner une vid√©o</h3>
            <div class="feature-content">
                <div class="custom-file-input">
                    <input type="file" id="fileInput" accept="video/*" onchange="handleFileSelect(event)">
                    <span id="fileInputText">Choisir un fichier</span>
                </div>
            </div>
        </div>

        <!-- Options -->
        <div class="feature-card">
            <div class="feature-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </div>
            <h3 class="feature-title">Options</h3>
            <div class="feature-content">
                <select id="languageSelect">
                    <option value="fr">Fran√ßais</option>
                    <option value="en">Anglais</option>
                    <option value="es">Espagnol</option>
                    <option value="de">Allemand</option>
                </select>
                <div class="custom-select" id="styleSelect">
                    <div class="custom-select-header" onclick="toggleSelect()">
                        <span id="selectedStyle">Style par d√©faut</span>
                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor">
                            <path d="M2 4L6 8L10 4" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="custom-select-options">
                        <div class="custom-select-option" data-value="default" onclick="selectStyle(this)">
                            Style par d√©faut
                            <div class="style-preview-container">
                                <div class="style-preview">
                                    <img src="/static/previews/default.png" alt="Style par d√©faut">
                                    <div class="style-description">Sous-titres classiques en bas de la vid√©o</div>
                                </div>
                            </div>
                        </div>
                        <div class="custom-select-option" data-value="youtube_shorts" onclick="selectStyle(this)">
                            YouTube Shorts
                            <div class="style-preview-container">
                                <div class="style-preview">
                                    <img src="/static/previews/shorts.png" alt="Style YouTube Shorts">
                                    <div class="style-description">Style optimis√© pour les formats courts, texte plus grand avec contours</div>
                                </div>
                            </div>
                        </div>
                        <div class="custom-select-option" data-value="minimalist" onclick="selectStyle(this)">
                            Minimaliste
                            <div class="style-preview-container">
                                <div class="style-preview">
                                    <img src="/static/previews/minimalist.png" alt="Style minimaliste">
                                    <div class="style-description">Design √©pur√© sans contour</div>
                                </div>
                            </div>
                        </div>
                        <div class="custom-select-option" data-value="karaoke" onclick="selectStyle(this)">
                            Karaoke
                            <div class="style-preview-container">
                                <div class="style-preview">
                                    <img src="/static/previews/karaoke.png" alt="Style karaok√©">
                                    <div class="style-description">Affichage mot par mot synchronis√© avec la parole</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dans la carte des options avanc√©es -->
        <div class="feature-card">
            <div class="feature-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="8" y1="6" x2="21" y2="6"></line>
                    <line x1="8" y1="12" x2="21" y2="12"></line>
                    <line x1="8" y1="18" x2="21" y2="18"></line>
                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                </svg>
            </div>
            <h3 class="feature-title">Options avanc√©es</h3>
            <div class="feature-content">
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="chapteringEnabled">
                    <span>Activer le chapitrage automatique</span>
                </label>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="generateShortsEnabled">
                    <span>G√©n√©rer des shorts</span>
                </label>
            </div>
        </div>

        <!-- Option pour nombre de mot par sous-titres -->

        <div class="feature-card">
            <div class="feature-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
            </div>
            <h3 class="feature-title">Longueur des sous-titres</h3>
            <label class="checkbox-wrapper">
                <input type="checkbox" id="enableWordLimit">
                <span>Personnaliser le nombre de mots par sous-titre</span>
            </label>
        </div>

    </div>

        <!-- Options pour le nombre de mots par sous-titre -->
        <div id="wordLimitOptions" class="shorts-options" style="display: none;">
            <!-- Nombre de mots par sous-titre -->
            <div class="shorts-option">
                <div class="option-label">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                    <span>Nombre de mots par sous-titre</span>
                </div>
                <div class="option-input">
                    <input type="number" id="wordLimitValue" min="1" max="20" value="5">
                </div>
            </div>
        </div>

        <!-- Dans la carte des options avanc√©es, apr√®s la checkbox generateShortsEnabled -->
        <div id="shortsOptions" class="shorts-options" style="display: none;">
            <!-- Nombre de shorts -->
            <div class="shorts-option">
                <div class="option-label">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span>Nombre de shorts</span>
                </div>
                <div class="option-input">
                    <input type="number" id="shortsCount" min="1" max="10" value="3">
                </div>
            </div>
        
            <!-- Dur√©e des shorts -->
            <div class="shorts-option">
                <div class="option-label">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span>Dur√©e des shorts (secondes)</span>
                </div>
                <div class="option-input">
                    <input type="number" id="shortsDuration" min="15" max="60" value="30">
                </div>
            </div>
            
            <!-- Nombre de mots par ligne pour les shorts -->
            <div class="shorts-option">
                <div class="option-label">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 7V4h16v3"></path>
                        <path d="M9 20h6"></path>
                        <path d="M12 4v16"></path>
                    </svg>
                    <span>Mots par ligne de sous-titre</span>
                </div>
                <div class="option-input">
                    <input type="number" id="shortsWordLimit" min="1" max="10" value="4">
                </div>
            </div>
        </div>

    <!-- Pr√©visualisation vid√©o -->
    <div class="video-preview-container" id="videoPreviewContainer" style="display: none;">
        <h3>Pr√©visualisation</h3>
        <div class="video-wrapper">
            <video id="videoPreview" controls>
                <source src="" type="video/mp4">
                Votre navigateur ne supporte pas la lecture vid√©o.
            </video>
        </div>
        <div class="video-metadata">
            <div class="metadata-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <span id="videoDuration">Dur√©e: 0:00</span>
            </div>
            <div class="metadata-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="9" y1="3" x2="9" y2="21"></line>
                </svg>
                <span id="videoDimensions">Dimensions: 0x0</span>
            </div>
            <div class="metadata-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                <span id="videoSize">Taille: 0 MB</span>
            </div>
        </div>
    </div>

    <!-- Barre de progression -->
    <div id="progressBarContainer" style="display: none;">
        <div class="progress-bar">
            <div class="progress-bar-fill" id="progressBarFill"></div>
        </div>
        <p class="progress-text" id="progressText">0%</p>
    </div>
    
    <!-- Notifications -->
    <div id="notificationContainer"></div>

    <!-- Zone de t√©l√©chargement -->
    <div id="downloadSection" class="download-section" style="display: none;">
        <h3>T√©l√©chargements</h3>
        <div class="download-grid">
            <!-- Bouton pour t√©l√©charger la vid√©o -->
            <div class="download-item">
                <div class="download-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#7c3aed" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </div>
                <a href="#" class="download-button" download>
                    T√©l√©charger la vid√©o
                </a>
                <p class="download-description">Vid√©o sous-titr√©e au format MP4</p>
            </div>
    
            <!-- Bouton pour t√©l√©charger les sous-titres -->
            <div class="download-item">
                <div class="download-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#7c3aed" stroke-width="2">
                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                        <polyline points="13 2 13 9 20 9"></polyline>
                    </svg>
                </div>
                <a href="#" class="download-button" download>
                    T√©l√©charger les sous-titres
                </a>
                <p class="download-description">Fichier VTT des sous-titres</p>
            </div>
    
            <!-- Bouton pour t√©l√©charger le ZIP -->
            <div class="download-item">
                <div class="download-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#7c3aed" stroke-width="2">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                        <line x1="12" y1="11" x2="12" y2="17"></line>
                        <line x1="9" y1="14" x2="15" y2="14"></line>
                    </svg>
                </div>
                <a href="#" class="download-button" download>
                    T√©l√©charger le ZIP
                </a>
                <p class="download-description">Archive ZIP contenant tous les fichiers</p>
            </div>
        </div>
    </div>

   

    <script>
    function handleFileSelect(event) {
        const file = event.target.files[0];
        const fileInputText = document.getElementById('fileInputText');
        
        if (file) {
            fileInputText.textContent = file.name;
            
            // Afficher la pr√©visualisation
            const videoPreview = document.getElementById('videoPreview');
            const videoPreviewContainer = document.getElementById('videoPreviewContainer');
            
            videoPreview.src = URL.createObjectURL(file);
            videoPreviewContainer.style.display = 'block';

            // Mettre √† jour les m√©tadonn√©es
            videoPreview.onloadedmetadata = function() {
                const duration = Math.round(videoPreview.duration);
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;
                
                document.getElementById('videoDuration').textContent = 
                    `Dur√©e: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('videoDimensions').textContent = 
                    `Dimensions: ${videoPreview.videoWidth}x${videoPreview.videoHeight}`;
            };

            // Afficher la taille du fichier
            const size = (file.size / (1024 * 1024)).toFixed(2);
            document.getElementById('videoSize').textContent = `Taille: ${size} MB`;
        }
    }

    function checkStatus() {
        fetch('/status')
            .then(response => response.json())
            .then(data => {
                if (data.progress) {
                    document.getElementById('progressBarFill').style.width = data.progress + '%';
                    document.getElementById('progressText').textContent = data.progress + '%';
                }
            });
    }

    function showNotification(message, type = 'info') {
        const notificationContainer = document.getElementById('notificationContainer');
    
        // Cr√©er la notification
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
    
        // Ajouter une ic√¥ne en fonction du type
        let iconPath = '';
        switch (type) {
            case 'info':
                iconPath = 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z';
                break;
            case 'error':
                iconPath = 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z';
                break;
            case 'success':
                iconPath = 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z';
                break;
        }

        notification.innerHTML = `
            <svg class="notification-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="${iconPath}"></path>
            </svg>
            <span>${message}</span>
        `;

        // Ajouter la notification au conteneur
        notificationContainer.appendChild(notification);

        // Afficher la notification
        setTimeout(() => {
            notification.classList.add('show');
        }, 10);

        // Masquer la notification apr√®s 3 secondes
        setTimeout(() => {
        notification.classList.remove('show');
            setTimeout(() => {
                notification.remove();
            }, 300); // Temps pour l'animation de disparition
        }, 3000);
    }

    // Variable globale pour stocker le style s√©lectionn√©
    let currentSelectedStyle = 'default';

    function selectStyle(element) {
        const value = element.getAttribute('data-value');
        const text = element.textContent.trim();
        
        // Stocker dans la variable globale
        currentSelectedStyle = value;
        
        console.log('%c Style s√©lectionn√©: ' + value, 'background: #4CAF50; color: white; padding: 2px 5px; border-radius: 3px;');
        
        // Mettre √† jour l'affichage
        const selectedStyleElement = document.getElementById('selectedStyle');
        selectedStyleElement.textContent = text;
        selectedStyleElement.setAttribute('data-selected-value', value);
        
        // Fermer le select
        document.getElementById('styleSelect').classList.remove('open');
    }

    function startProcess() {
        const file = document.getElementById('fileInput').files[0];
        if (!file) {
            showNotification('Veuillez s√©lectionner une vid√©o', 'error');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);
        formData.append('language', document.getElementById('languageSelect').value);
        
        // Utiliser la variable globale pour le style
        console.log('%c Style envoy√© au serveur: ' + currentSelectedStyle, 'background: #2196F3; color: white; padding: 2px 5px; border-radius: 3px;');
        formData.append('style', currentSelectedStyle);
        
        formData.append('createChapters', document.getElementById('chapteringEnabled').checked);
        formData.append('createShorts', document.getElementById('generateShortsEnabled').checked);

        // Afficher la barre de progression
        const uploadProgress = document.createElement('div');
        uploadProgress.className = 'upload-progress';
        uploadProgress.innerHTML = `
            <div class="upload-progress-bar">
                <div class="upload-progress-fill"></div>
            </div>
            <div class="upload-progress-text">0%</div>
        `;
        document.querySelector('.feature-card').appendChild(uploadProgress);
        uploadProgress.style.display = 'block';

        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/upload', true);

        xhr.upload.onprogress = function(e) {
            if (e.lengthComputable) {
                const percentComplete = (e.loaded / e.total) * 100;
                uploadProgress.querySelector('.upload-progress-fill').style.width = percentComplete + '%';
                uploadProgress.querySelector('.upload-progress-text').textContent = Math.round(percentComplete) + '%';
            }
        };

        xhr.onload = function() {
            if (xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                console.log("R√©ponse compl√®te du serveur:", response); // Debug log

                if (response.error) {
                    showNotification(response.error, 'error');
                } else {
                    showNotification('Traitement termin√© !');
                    
                    // Afficher les r√©sultats
                    const downloadSection = document.getElementById('downloadSection');
                    downloadSection.style.display = 'block';

                    // Si la g√©n√©ration de shorts est activ√©e
                    if (document.getElementById('generateShortsEnabled').checked) {
                        // Extraire le nom du fichier avec timestamp de l'URL vid√©o
                        const videoFilename = response.video_url.split('/').pop().replace('_subtitled.mp4', '.mp4');
                        console.log("Nom du fichier pour les shorts:", videoFilename);
                        generateShorts(videoFilename, response.vtt_url);
                    }
                    
                    downloadSection.innerHTML = `
                        <a href="${response.video_url}" class="download-button" download>T√©l√©charger la vid√©o</a>
                        <a href="${response.vtt_url}" class="download-button" download>T√©l√©charger le fichier .vtt</a>
                        
                        <form action="/generate_zip" method="POST">
                            <input type="hidden" name="chapters" value="${response.chapters || ''}">
                            <input type="hidden" name="video_url" value="${response.video_url}">
                            <input type="hidden" name="vtt_url" value="${response.vtt_url}">
                            <input type="hidden" name="summary" value="${response.summary || ''}">
                            <input type="hidden" name="personal_summary" value="${response.personal_summary || ''}">
                            <input type="hidden" name="keywords" value="${response.keywords || ''}">
                            <button type="submit" class="download-button">T√©l√©charger le ZIP</button>
                        </form>
                        
                    
                        ${response.chapters ? `
                            <div id="chaptersSection">
                                <h3>Chapitres g√©n√©r√©s</h3>
                                <pre>${response.chapters}</pre>
                            </div>
                            <div id="summarySection">
                                <h3>R√©sum√© global</h3>
                                <p>${response.summary}</p>
                            </div>
                            <div id="personalSummarySection">
                                <h3>R√©sum√© √† la premi√®re personne</h3>
                                <p>${response.personal_summary}</p>
                            </div>
                            <div id="keywordsSection">
                                <h3>Mots-cl√©s</h3>
                                <p>${response.keywords}</p>
                            </div>
                        ` : ''}
                    `;
                }
            } else {
                showNotification('Erreur lors du traitement', 'error');
            }
            uploadProgress.remove();
            document.getElementById('progressBarContainer').style.display = 'block';
        };

        //  Ajout du nombre de mots par sous-titre
        if (document.getElementById('enableWordLimit').checked) {
            formData.append('wordLimit', document.getElementById('wordLimitValue').value);
        }

        xhr.send(formData);
        const statusInterval = setInterval(checkStatus, 1000);
    }

    function generateShorts(originalVideoFilename, vttUrl) {
        const formData = new FormData();
        formData.append('original_video_filename', originalVideoFilename);
        formData.append('vtt_path', vttUrl);

        formData.append('shorts_count', document.getElementById('shortsCount').value);
        formData.append('shorts_duration', document.getElementById('shortsDuration').value);
        formData.append('style', currentSelectedStyle);
        
        // Ajouter le param√®tre word_limit
        const shortsWordLimit = document.getElementById('shortsWordLimit').value;
        if (shortsWordLimit && parseInt(shortsWordLimit) > 0) {
            formData.append('word_limit', shortsWordLimit);
        }

        console.log('D√©but de la g√©n√©ration des shorts avec:', {
            originalVideoFilename,
            vttUrl,
            shortsCount: document.getElementById('shortsCount').value,
            shortsDuration: document.getElementById('shortsDuration').value,
            wordLimit: shortsWordLimit
        });

        fetch('/generate_shorts', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.shorts) {
                const shortsSection = document.createElement('div');
                shortsSection.id = 'shortsSection';
                
                shortsSection.innerHTML = `
                    <h3>Shorts g√©n√©r√©s</h3>
                    <div class="shorts-container">
                        <div class="short-card">
                            ${data.shorts.map(short => `
                                <div class="short-item">
                                    <video controls class="short-preview">
                                        <source src="${short.url}" type="video/mp4">
                                    </video>
                                    <div class="short-info">
                                        <p>${short.description}</p>
                                        <p>Dur√©e: ${short.start} - ${short.end}</p>
                                        <a href="${short.url}" download class="short-download-button">T√©l√©charger</a>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                document.getElementById('downloadSection').appendChild(shortsSection);
            }
        })
        .catch(error => {
            console.error('Erreur:', error);
            showNotification('Erreur lors de la g√©n√©ration des shorts', 'error');
        });
    }

    function deleteFile(filename) {
        fetch(`/delete/${filename}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Fichier supprim√© avec succ√®s');
                document.getElementById('downloadSection').style.display = 'none';
            } else {
                showNotification('Erreur lors de la suppression', 'error');
            }
        });
    }

    function toggleSelect() {
        const select = document.getElementById('styleSelect');
        select.classList.toggle('open');
    }

    // Fermer le select si on clique ailleurs
    document.addEventListener('click', function(e) {
        const select = document.getElementById('styleSelect');
        if (!select.contains(e.target)) {
            select.classList.remove('open');
        }
    });


    // Ajouter ce script JavaScript
    document.getElementById('generateShortsEnabled').addEventListener('change', function() {
        document.getElementById('shortsOptions').style.display = this.checked ? 'block' : 'none';
    });

    // Ajouter l'√©v√©nement pour afficher les options de limite de mots
    document.getElementById('enableWordLimit').addEventListener('change', function() {
        let optionsContainer = document.getElementById('wordLimitOptions');

        if (this.checked) {
            optionsContainer.style.display = 'block';
        } else {
            optionsContainer.style.display = 'none';
        }
    });

    // Synchroniser les valeurs entre les deux inputs de limite de mots
    document.getElementById('wordLimitValue').addEventListener('input', function() {
        // Garde uniquement la synchronisation avec le backend
    });
    </script>

    <!-- Ajout des scripts Firebase pour initialisation et authentification -->
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js"></script>
    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDDVjaqp5RpQzDfoSayfvhW7LhTfW2i3mI",
            authDomain: "pfe9-6de23.firebaseapp.com",
            projectId: "pfe9-6de23",
        };
        // Initialisez Firebase
        firebase.initializeApp(firebaseConfig);
    </script>


    <script>
        // Fonction de connexion
        function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            // Utilisation de Firebase Authentication pour se connecter
            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    alert("Connexion r√©ussie !");
                    const user = userCredential.user;
                    console.log("Utilisateur connect√© :", user);

                    // Obtenir le token d'authentification et l'envoyer au backend
                    user.getIdToken().then(function(idToken) {
                        sendTokenToBackend(idToken);
                    });
                })
                .catch((error) => {
                    console.error("Erreur de connexion :", error);
                    alert("Erreur de connexion : " + error.message);
                });
        }

        // Fonction pour envoyer le token au backend
        function sendTokenToBackend(idToken) {
            fetch('/verify-token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ idToken: idToken })
            })
            .then(response => response.json())
            .then(data => {
                console.log("R√©ponse du backend :", data);
            })
            .catch((error) => {
                console.error("Erreur d'envoi du token :", error);
            });
        }
        function toggleUserMenu() {
        const dropdownMenu = document.getElementById('dropdownMenu');
        dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
        }

        // Fermer le menu si on clique ailleurs
        document.addEventListener('click', function(e) {
            const dropdownMenu = document.getElementById('dropdownMenu');
            const userIcon = document.querySelector('.user-icon');
            if (!userIcon.contains(e.target)) {
                dropdownMenu.style.display = 'none';
            }
        });
    </script>
</body>
</html>